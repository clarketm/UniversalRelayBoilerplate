{"version":3,"sources":["../../../units/urb-base-tools/build-units.js"],"names":["existsAsync","exists","readFileAsync","readFile","readdirAsync","readdir","sortObject","object","t","Object","keys","sort","forEach","k","orderPackages","packageAsObject","scripts","dependencies","devDependencies","mergeScripts","scripts1","scripts2","assign","scriptName","script","script2","createPackageJson","units","packageJsonFileName","resolve","currentPackageAsJSONString","toString","currentPackageAsObject","JSON","parse","engines","name","prettier","version","unitName","packageAsObjectName","packageToAddAsObject","stringify","createMutations","mutationsImports","mutationsExports","endsWith","mutationsDir","mutationFileNames","mutationFileName","mutation","substring","length","push","replace","mutations","concat","format","join","createSchemas","schemasImports","schemasDir","objectTypeFileNames","objectTypeFileName","objectType","schemas","createViewerFields","viewerFieldsImports","viewerFieldsExports","viewerFieldsFileName","viewerFieldsImportName","viewerFields","createRoutes","routesAppFrameImports","routesRootImports","routesAppFrameExports","routesRootExports","routesDir","routeFileNames","routeFileName","startsWith","route","Promise","all","createRouteFile","fileName","imports","exports","routesAppFrame","getUnits","filter","main","taskPromises","then","console","log"],"mappings":"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","file":"build-units.js","sourcesContent":["// @flow\n\nimport fs from 'fs'\nimport path from 'path'\nimport { promisify } from 'util'\n\nimport prettier from 'prettier'\n\n// $FlowIssue Not sure why it gives an error. The file does exist\nimport packageJSON from '../../package.json'\n\nimport ensureFileContent from './ensureFileContent'\n\nconst existsAsync = promisify( fs.exists )\nconst readFileAsync = promisify( fs.readFile )\nconst readdirAsync = promisify( fs.readdir )\n\nfunction sortObject( object: Object ) {\n  var t = {}\n  Object.keys( object )\n    .sort()\n    .forEach( function( k ) {\n      t[k] = object[k]\n    })\n  return t\n}\n\nfunction orderPackages( packageAsObject ) {\n  packageAsObject.scripts = sortObject( packageAsObject.scripts )\n  packageAsObject.dependencies = sortObject( packageAsObject.dependencies )\n  packageAsObject.devDependencies = sortObject( packageAsObject.devDependencies )\n}\n\nfunction mergeScripts( scripts1, scripts2 ) {\n  const scripts = Object.assign({}, scripts1 )\n\n  for ( let scriptName in scripts2 ) {\n    const script = scripts[scriptName]\n    const script2 = scripts2[scriptName]\n\n    if ( script && script2 ) {\n      scripts[scriptName] = script + ' && ' + script2\n    } else if ( script2 ) {\n      scripts[scriptName] = script2\n    }\n  }\n\n  return scripts\n}\n\nasync function createPackageJson( units: Array<string> ) {\n  const packageJsonFileName = path.resolve( './package.json' )\n  const currentPackageAsJSONString = ( await readFileAsync( packageJsonFileName ) ).toString()\n  const currentPackageAsObject = JSON.parse( currentPackageAsJSONString )\n  const packageAsObject = {\n    dependencies: {},\n    devDependencies: {},\n    engines: {},\n    'lint-staged': {},\n    name: null,\n    prettier: {},\n    scripts: {},\n    version: null,\n  }\n\n  // Make sure not to overwrite version information\n  packageAsObject.version = currentPackageAsObject.version\n  packageAsObject.name = currentPackageAsObject.name\n\n  // Add packages to object\n  for ( let unitName of units ) {\n    const packageAsObjectName = path.resolve( './units', unitName, 'package.part.json' )\n    if ( await existsAsync( packageAsObjectName ) ) {\n      const packageToAddAsObject = JSON.parse( ( await readFileAsync( packageAsObjectName ) ).toString() )\n\n      if ( packageToAddAsObject.dependencies )\n        Object.assign( packageAsObject.dependencies, packageToAddAsObject.dependencies )\n      if ( packageToAddAsObject.devDependencies )\n        Object.assign( packageAsObject.devDependencies, packageToAddAsObject.devDependencies )\n      if ( packageToAddAsObject.engines )\n        Object.assign( packageAsObject.engines, packageToAddAsObject.engines )\n      if ( packageToAddAsObject['lint-staged'])\n        Object.assign( packageAsObject['lint-staged'], packageToAddAsObject['lint-staged'])\n      if ( packageToAddAsObject.prettier )\n        Object.assign( packageAsObject.prettier, packageToAddAsObject.prettier )\n      if ( packageToAddAsObject.scripts )\n        packageAsObject.scripts = mergeScripts(\n          packageAsObject.scripts,\n          packageToAddAsObject.scripts,\n        )\n    }\n  }\n\n  // Make them pretty\n  orderPackages( packageAsObject )\n\n  await ensureFileContent(\n    packageJsonFileName,\n    currentPackageAsJSONString,\n    JSON.stringify( packageAsObject, null, 2 ),\n  )\n}\n\nasync function createMutations( units: Array<string> ) {\n  const mutationsImports = []\n  const mutationsExports = []\n\n  for ( let unitName of units )\n    if ( unitName.endsWith( '-server' ) ) {\n      const mutationsDir = path.resolve( './units', unitName, 'graphql/mutation' )\n      if ( await existsAsync( mutationsDir ) ) {\n        const mutationFileNames = await readdirAsync( mutationsDir )\n\n        for ( let mutationFileName of mutationFileNames ) {\n          if ( mutationFileName.endsWith( '.js' ) ) {\n            const mutation = mutationFileName.substring( 0, mutationFileName.length - 3 )\n            mutationsImports.push(\n              'import ' +\n                mutation.replace( '.', '_' ) +\n                ' from \\'../../../' +\n                unitName +\n                '/graphql/mutation/' +\n                mutation +\n                '\\'',\n            )\n            mutationsExports.push( '  ' + mutation + ',' )\n          }\n        }\n      }\n    }\n\n  let mutations = [ '// @flow', '' ]\n  mutations = mutations.concat( mutationsImports )\n  mutations = mutations.concat([ '', 'export default {' ])\n  mutations = mutations.concat( mutationsExports )\n  mutations = mutations.concat([ '}' ])\n\n  await ensureFileContent(\n    path.resolve( './units/_configuration/urb-base-server/graphql/_mutations.js' ),\n    null,\n    prettier.format( mutations.join( '\\r\\n' ), packageJSON.prettier ),\n  )\n}\n\nasync function createSchemas( units: Array<string> ) {\n  const schemasImports = []\n\n  for ( let unitName of units )\n    if ( unitName.endsWith( '-server' ) ) {\n      const schemasDir = path.resolve( './units', unitName, 'graphql/model' )\n      if ( await existsAsync( schemasDir ) ) {\n        const objectTypeFileNames = await readdirAsync( schemasDir )\n\n        for ( let objectTypeFileName of objectTypeFileNames ) {\n          if ( objectTypeFileName.endsWith( '.js' ) ) {\n            const objectType = objectTypeFileName.substring( 0, objectTypeFileName.length - 3 )\n            schemasImports.push(\n              'import \\'../../../' + unitName + '/graphql/model/' + objectType + '\\'',\n            )\n          }\n        }\n      }\n    }\n\n  let schemas = [ '// @flow', '' ]\n  schemas = schemas.concat( schemasImports )\n  schemas = schemas.concat([ '', 'export default true' ])\n\n  await ensureFileContent(\n    path.resolve( './units/_configuration/urb-base-server/graphql/_schemas.js' ),\n    null,\n    prettier.format( schemas.join( '\\r\\n' ), packageJSON.prettier ),\n  )\n}\n\nasync function createViewerFields( units: Array<string> ) {\n  const viewerFieldsImports = []\n  const viewerFieldsExports = []\n\n  for ( let unitName of units )\n    if ( unitName.endsWith( '-server' ) ) {\n      const viewerFieldsFileName = path.resolve(\n        './units',\n        unitName,\n        'graphql/type/_ViewerFields.js',\n      )\n      if ( await existsAsync( viewerFieldsFileName ) ) {\n        const viewerFieldsImportName = unitName.replace( /-/g, '_' )\n        viewerFieldsImports.push(\n          'import ' +\n            viewerFieldsImportName +\n            ' from \\'../../../' +\n            unitName +\n            '/graphql/type/_ViewerFields\\'',\n        )\n        viewerFieldsExports.push( '  ...' + viewerFieldsImportName + ',' )\n      }\n    }\n\n  let viewerFields = [ '// @flow', '' ]\n  viewerFields = viewerFields.concat( viewerFieldsImports )\n  viewerFields = viewerFields.concat([ '', 'export default {' ])\n  viewerFields = viewerFields.concat( viewerFieldsExports )\n  viewerFields = viewerFields.concat([ '}' ])\n\n  await ensureFileContent(\n    path.resolve( './units/_configuration/urb-base-server/graphql/_ViewerFields.js' ),\n    null,\n    prettier.format( viewerFields.join( '\\r\\n' ), packageJSON.prettier ),\n  )\n}\n\nasync function createRoutes( units: Array<string> ) {\n  const routesAppFrameImports = []\n  const routesRootImports = []\n  const routesAppFrameExports = []\n  const routesRootExports = []\n\n  for ( let unitName of units )\n    if ( unitName.endsWith( '-webapp' ) ) {\n      const routesDir = path.resolve( './units', unitName )\n      if ( await existsAsync( routesDir ) ) {\n        const routeFileNames = await readdirAsync( routesDir )\n\n        for ( let routeFileName of routeFileNames ) {\n          if ( routeFileName.endsWith( '.jsx' ) )\n            if ( routeFileName.startsWith( 'routeAppFrame' ) ) {\n              const route = routeFileName.substring( 0, routeFileName.length - 4 )\n              routesAppFrameImports.push(\n                'import ' + route + ' from \\'../../' + unitName + '/' + route + '\\'',\n              )\n              routesAppFrameExports.push( '  ' + route + ',' )\n            } else if ( routeFileName.startsWith( 'routeRoot' ) ) {\n              const route = routeFileName.substring( 0, routeFileName.length - 4 )\n              routesRootImports.push(\n                'import ' + route + ' from \\'../../' + unitName + '/' + route + '\\'',\n              )\n              routesRootExports.push( '  ' + route + ',' )\n            }\n        }\n      }\n    }\n\n  await Promise.all([\n    createRouteFile(\n      path.resolve( './units/_configuration/urb-base-webapp/routesAppFrame.js' ),\n      routesAppFrameImports,\n      routesAppFrameExports,\n    ),\n    createRouteFile(\n      path.resolve( './units/_configuration/urb-base-webapp/routesRoot.js' ),\n      routesRootImports,\n      routesRootExports,\n    ),\n  ])\n}\n\nasync function createRouteFile( fileName: string, imports: Array<string>, exports: Array<string> ) {\n  let routesAppFrame = [ '// @flow', '' ]\n  routesAppFrame = routesAppFrame.concat( imports )\n  routesAppFrame = routesAppFrame.concat([ '', 'export default [' ])\n  routesAppFrame = routesAppFrame.concat( exports )\n  routesAppFrame = routesAppFrame.concat([ ']' ])\n\n  await ensureFileContent(\n    fileName,\n    null,\n    prettier.format( routesAppFrame.join( '\\r\\n' ), packageJSON.prettier ),\n  )\n}\n\nasync function getUnits() {\n  const units = ( await readdirAsync( './units/' ) ).filter(\n    fileName => fileName !== '.DS_Store' && fileName !== '_configuration',\n  )\n  return units\n}\n\nasync function main() {\n  const units = await getUnits()\n\n  const taskPromises = [\n    createPackageJson( units ),\n    createViewerFields( units ),\n    createSchemas( units ),\n    createMutations( units ),\n    createRoutes( units ),\n  ]\n\n  await Promise.all( taskPromises )\n}\n\nmain().then( () => console.log( 'Fin.' ) )\n"]}